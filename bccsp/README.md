# Blockchain Cryptographic Service Provider (BCCSP)

`bccsp` 包为区块链平台提供了各种密码服务。

## 1 概念介绍

### 1.1 密文分组连接模式(Cipher Block Chaining, CBC)

在 `CBC` 模式中，首先将明文分组与前一个密文分组进行 `XOR` 运算，然后再进行加密。加解密原理如下图所示：

<img src="../pics/11.png">

#### 1.1.1 初始化向量(Initialization Vector, IV)

当加密第一个明文分组是，由于不存在“前一个密文分组”，因此需要事先准备一个长度为一个分组的比特序列来替代“前一个密文分组”，这个比特序列称为初始化向量 ，通常缩写为 `IV`。每次加密时都会随机产生一个不同的比特序列来作为初始化向量。

### 1.2 数据填充规则之PKCS7

在数据加解密应用中，数据填充是其中重要的组成部分。数据填充通常有两个作用一是按要求将数据补足到加密算法要求的长度；二是通过增加填充数据来进一步提高密文的安全性。`PKCS7` 是分组对称算法中常用的数据填充规则。

`PKCS7` 的填充方式为当数据长度不足数据块长度时,缺 `x` 位就补 `x` 个 `byte(x)`。对于 `AES128` 算法其数据块为 `16 byte`（待加密的明文长度需要为 `16 byte` 的倍数）,如果数据为 `"00112233445566778899AA"` 一共 `11` 个字节,缺了 `5` 位,采用 `PKCS7` 方式填充之后的数据为 `"00112233445566778899AA0505050505"`。

特别注意的一点是如果是数据刚好满足数据块长度也要在元数据后在按PKCS7规则填充一个数据块数据，这样做的目的是为了区分有效数据和补齐数据。仍以 `AES128` 为例：如果数据为 `"00112233445566778899AABBCCDDEEFF"` 一共 `16` 个自己，采用 `PKCS7` 方式填充之后的数据为 `"00112233445566778899AABBCCDDEEFF10101010101010101010101010101010"`。

### 1.3 PEM 数据编码

`PEM` 格式通常用于数字证书认证机构（Certificate Authorities，CA），扩展名为 `.pem`，`.crt`，`.cer` 和 `.key`。内容为 `Base64` 编码的 `ASCII` 码文件，有类似 `"-----BEGIN CERTIFICATE-----"` 和 `"-----END CERTIFICATE-----"` 的头尾标记。服务器认证证书，中级认证证书和私钥都可以储存为 `PEM` 格式（认证证书其实就是公钥）。`Apache` 和类似的服务器使用 `PEM` 格式证书。